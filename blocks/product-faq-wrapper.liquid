{% comment %}
  Product FAQ Block
  Displays FAQ content from product metafields

  Required metafields namespace: custom.product_faq
  With fields: Question, Question_Number, Answer
{% endcomment %}

{% schema %}
{
  "name": "Product FAQs",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "FAQ Section Title",
      "default": "Frequently Asked Questions"
    },
    {
      "type": "select",
      "id": "layout",
      "label": "Layout Style",
      "options": [
        {
          "value": "accordion",
          "label": "Accordion (Expand/Collapse)"
        },
        {
          "value": "list",
          "label": "Full List (Always Expanded)"
        }
      ],
      "default": "accordion"
    },
    {
      "type": "checkbox",
      "id": "show_numbers",
      "label": "Show Question Numbers",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "Product FAQs"
    }
  ],
}
{% endschema %}

<div class="product-faq-container">
  <h2 class="product-faq-title">{{ section.settings.title }}</h2>

  {% comment %} Specifically target custom.product_faq metafields {% endcomment %}
  {% assign faq_items = product.metafields.custom.product_faq %}

  {% if faq_items != blank %}
    <div class="product-faq-list {% if section.settings.layout == 'accordion' %}faq-accordion{% else %}faq-list{% endif %}">
      {% comment %} Determine if this is a single FAQ or multiple FAQs {% endcomment %}
      {% if faq_items.first.Question %}
        {% comment %} Handle multiple FAQs (array of objects) {% endcomment %}
        {% assign sorted_faqs = faq_items | sort: 'Question_Number' %}

        {% for faq in sorted_faqs %}
          <div class="faq-item" id="faq-item-{{ forloop.index }}">
            <div class="faq-question {% if section.settings.layout == 'accordion' %}accordion-toggle{% endif %}">
              {% if section.settings.show_numbers and faq.Question_Number != blank %}
                <span class="faq-question-number">{{ faq.Question_Number }}.</span>
              {% elsif section.settings.show_numbers %}
                <span class="faq-question-number">{{ forloop.index }}.</span>
              {% endif %}
              <h3>{{ faq.Question }}</h3>
              {% if section.settings.layout == 'accordion' %}
                <span class="accordion-icon">+</span>
              {% endif %}
            </div>

            <div class="faq-answer {% if section.settings.layout == 'accordion' %}accordion-content{% endif %}">
              <div class="answer-content">
                {{ faq.Answer }}
              </div>
            </div>
          </div>
        {% endfor %}
      {% else %}
        {% comment %} Handle single FAQ (direct object) {% endcomment %}
        <div class="faq-item" id="faq-item-1">
          <div class="faq-question {% if section.settings.layout == 'accordion' %}accordion-toggle{% endif %}">
            {% if section.settings.show_numbers and faq_items.Question_Number != blank %}
              <span class="faq-question-number">{{ faq_items.Question_Number }}.</span>
            {% elsif section.settings.show_numbers %}
              <span class="faq-question-number">1.</span>
            {% endif %}
            <h3>{{ faq_items.Question }}</h3>
            {% if section.settings.layout == 'accordion' %}
              <span class="accordion-icon">+</span>
            {% endif %}
          </div>

          <div class="faq-answer {% if section.settings.layout == 'accordion' %}accordion-content{% endif %}">
            <div class="answer-content">
              {{ faq_items.Answer }}
            </div>
          </div>
        </div>
      {% endif %}
    </div>
  {% else %}
    <p class="no-faqs-message">No FAQs available for this product. Please check the metafield configuration.</p>
  {% endif %}
</div>

{% if section.settings.layout == 'accordion' %}
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const toggles = document.querySelectorAll('.accordion-toggle');

      toggles.forEach(toggle => {
        toggle.addEventListener('click', function() {
          const content = this.nextElementSibling;
          const icon = this.querySelector('.accordion-icon');

          // Toggle active class
          this.classList.toggle('active');

          // Toggle content visibility
          if (content.style.maxHeight) {
            content.style.maxHeight = null;
            icon.textContent = '+';
          } else {
            content.style.maxHeight = content.scrollHeight + 'px';
            icon.textContent = 'âˆ’';
          }
        });
      });
    });
  </script>
{% endif %}

<style>
  .product-faq-container {
    margin: 40px 0;
    padding: 0 20px;
  }

  .product-faq-title {
    text-align: center;
    margin-bottom: 30px;
    font-size: 24px;
  }

  .product-faq-list {
    max-width: 800px;
    margin: 0 auto;
  }

  .faq-item {
    margin-bottom: 15px;
    border: 1px solid #e8e8e8;
    border-radius: 4px;
  }

  .faq-question {
    padding: 15px;
    background-color: #f7f7f7;
    display: flex;
    align-items: flex-start;
    cursor: pointer;
  }

  .faq-question h3 {
    margin: 0;
    font-size: 16px;
    flex-grow: 1;
  }

  .faq-question-number {
    margin-right: 10px;
    font-weight: bold;
  }

  .accordion-icon {
    font-size: 18px;
    font-weight: bold;
  }

  .faq-answer {
    padding: 0 15px;
    background-color: #ffffff;
  }

  .accordion-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-out;
  }

  .answer-content {
    padding: 15px 0;
  }

  .no-faqs-message {
    text-align: center;
    color: #777;
    padding: 20px;
  }
</style>
